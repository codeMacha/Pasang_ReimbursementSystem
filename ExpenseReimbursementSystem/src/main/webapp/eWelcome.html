<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<link rel="stylesheet" type="text/css" href="clean.css">
<link rel="icon" href="logo.png" type = "image/x-icon">
</head>
<body>
<div>
	<img src="tenor.gif" alt="pic goes here" width="80px" height="80px">
</div>

	<h2 id="Name">Employee Name: </h2>
<div class="stick">
	<div class="topnav">
	  <a class="active" href="#home">Home</a>
	  <a href="#news">News</a>
	  <a href="#contact">Contact</a>
	  <a href="#about">About</a>
	  <a href="Logout">Logout</a>
	</div>
</div>

	
	<h3></h3>
	<form>
		<input id="descInput" type="text" placeholder="Description">
		<input id="amount" type="number" placeholder="0.00">
		<button id="addReimbursementBtn">Add Reimbursement</button>
	</form>
	
	<h3>Your Submitted Reimbursements</h3>
	<button id="allBtn" type="button" class="btn ">Get All Reimbursements</button>
	<button id="approvedBtn" >Get Approved Reimbursements</button>
	<button id="rejectedBtn" >Get Rejected Reimbursements</button>
	
	
	<table id="reimbursementTable">
	    <thead><tr><th>Id</th><th>Description</th><th>Amount</th><th>Employee_id</th><th>Status</th></tr></thead>
	</table>
	

</body>

<script>
	getEmployeeInfo()
	document.getElementById("allBtn").addEventListener("click",getAllReimbursements,false);
	document.getElementById("approvedBtn").addEventListener("click",getApprovedReimbursements,false);
	document.getElementById("rejectedBtn").addEventListener("click",getRejectedReimbursements,false);
	document.getElementById("addReimbursementBtn").addEventListener("click",addReimbursement);

	async function getAllReimbursements(){
		cleartable()
        let httpResponse = await fetch("http://localhost:8080/ExpenseReimbursementSystem/api/emplreimbursements");
        let tasks = await httpResponse.json();
        let tableData = document.getElementById("reimbursementTable");

        for(task of tasks){
            tableData.innerHTML = tableData.innerHTML + `<tr><td> ${task.rId} </td> <td> ${task.description} </td>
            <td> ${task.amount} </td>  <td> ${task.requesterId} </td> <td> ${task.status}</td> </tr>`;   
        }   
          
    }
	
	async function getApprovedReimbursements(){
		
		cleartable()
        let httpResponse = await fetch("http://localhost:8080/ExpenseReimbursementSystem/api/emplreimbursements");
        let tasks = await httpResponse.json();
        
        let tableData = document.getElementById("reimbursementTable");

        for(task of tasks){
        	if(task.status == "approved"){
	            tableData.innerHTML = tableData.innerHTML + `<tr><td> ${task.rId} </td> <td> ${task.description} </td>
	            <td> ${task.amount} </td>  <td> ${task.requesterId} </td> <td> ${task.status}</td> </tr>`;
        	}    
        }
    }
	
	async function getRejectedReimbursements(){
		cleartable()
        let httpResponse = await fetch("http://localhost:8080/ExpenseReimbursementSystem/api/emplreimbursements");
        let tasks = await httpResponse.json();
        let tableData = document.getElementById("reimbursementTable");

        for(task of tasks){
        	if(task.status == "rejected"){
	            tableData.innerHTML = tableData.innerHTML + `<tr><td> ${task.rId} </td> <td> ${task.description} </td>
	            <td> ${task.amount} </td>  <td> ${task.requesterId} </td> <td> ${task.status}</td> </tr>`;
        	}
        }    
       
    }

	async function addReimbursement(){
	    
	    let reimbursement = {
	        rId:0,
	        status:"submitted"
	    }
	    // appending the properties to the object after it is created
	    reimbursement.description = document.getElementById("descInput").value;
	    reimbursement.amount = Number.parseInt(document.getElementById("amount").value);
	
	    let settings = {
	        method:'POST',
	        headers:{'Content-Type':'application/json'},
	        body: JSON.stringify(reimbursement)
	    }
	
	    let httpResponse = await fetch("http://localhost:8080/ExpenseReimbursementSystem/api/addreimbursement", settings); 
	    console.log(httpResponse)
	}
	
	async function getEmployeeInfo() {
		let httpResponse = await fetch("http://localhost:8080/ExpenseReimbursementSystem/api/employee");
        let info = await httpResponse.json();
        let profile = document.getElementById("Name");
        
        profile.innerHTML = profile.innerHTML + ` ${info.name}`;
        console.log(info);
	}
	
	function cleartable(){
        let rows = document.getElementById("reimbursementTable").rows.length - 1;
        let counter = 1;
        while(counter < rows)
	        document.getElementById("reimbursementTable").deleteRow(counter);
	        counter++;
        
    }
	
	


</script>
</html>